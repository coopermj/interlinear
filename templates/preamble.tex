\documentclass[11pt,oneside]{article}

% LuaLaTeX font support
\usepackage{fontspec}

% Microtypography - LuaLaTeX compatible features only
% (kerning and spacing require pdfTeX, not available in LuaLaTeX)
\usepackage[
    activate={true,nocompatibility},  % Enable protrusion and expansion
    final,                            % Enable in final mode
    protrusion=true,                  % Character protrusion (optical margins)
    expansion=true,                   % Font expansion for better justification
    tracking=true,                    % Letter spacing for small caps
    kerning=false,                    % Not supported in LuaLaTeX
    spacing=false                     % Not supported in LuaLaTeX
]{microtype}

% Parallel columns that stay synchronized
\usepackage{paracol}

% Page geometry - Remarkable Paper Pro: 179mm x 239mm display
\usepackage[
    papersize={179mm,239mm},
    margin=10mm,
    top=15mm,
    bottom=15mm,
    columnsep=8mm
]{geometry}

% Better paragraph handling
\usepackage{parskip}

% Color support
\usepackage{xcolor}

% Hyperlinks with PDF bookmarks
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    bookmarks=true,
    bookmarksopen=true,
    bookmarksnumbered=false,
    pdftitle={Interlinear Bible},
    pdfauthor={Generated with OpenGNT and ESV}
}

% For fancy headers and footers
\usepackage{fancyhdr}

% Font Awesome 5 icons
\usepackage{fontawesome5}

% For multi-column appendix
\usepackage{multicol}

% For preventing orphaned headings
\usepackage{needspace}

% Scripture-style verse formatting (mimics scripture.sty without requiring its environment)
% Define \vs command for verse numbers in ESV text

% ============================================
% Font Configuration
% ============================================

% Adobe fonts path
\newcommand{\adobefontpath}{/Users/micahcooper/Library/Application Support/Adobe/CoreSync/plugins/livetype/.r/}

% Bembo Book MT Pro for ESV text (right column)
\newfontfamily\bembofont[
    Path={\adobefontpath},
    UprightFont={.60754.otf},
    ItalicFont={.60740.otf},
    BoldFont={.60755.otf},
    BoldItalicFont={.60741.otf}
]{BemboBookMTPro}

% Gentium Plus for Greek text
\IfFontExistsTF{Gentium Plus}{
    \setmainfont{Gentium Plus}
    \newfontfamily\greekfont{Gentium Plus}[Script=Greek]
}{
    \IfFontExistsTF{GentiumPlus}{
        \setmainfont{GentiumPlus}
        \newfontfamily\greekfont{GentiumPlus}[Script=Greek]
    }{
        % Fallback to default fonts
        \setmainfont{Latin Modern Roman}
        \newfontfamily\greekfont{Latin Modern Roman}
    }
}

% ============================================
% Column Configuration
% ============================================
% Left column (Greek interlinear): 52%
% Right column (ESV): 48%
\columnratio{0.52}

% Set left column to ragged right to prevent overflow
\AtBeginDocument{%
    \setcolumnwidth{0.52\textwidth, 0.48\textwidth}%
}

% ============================================
% Custom Commands
% ============================================

% Interlinear gloss: Greek word with English above
% Usage: \gloss{Greek}{english}
% Reduced vertical spacing for tighter leading
\newcommand{\gloss}[2]{%
    \mbox{%
        \begin{tabular}[b]{@{}c@{}}
            {\scriptsize\color{gray}#2}\\[-4pt]
            {\greekfont #1}
        \end{tabular}%
    }\hspace{0.15em}\allowbreak%
}

% Verse number in superscript (for Greek column)
\newcommand{\versenum}[1]{%
    \textsuperscript{\textbf{#1}}\hspace{0.15em}%
}

% ESV verse number - scripture.sty style (superscript)
% Usage: \vs{1} for verse 1
\newcommand{\vs}[1]{%
    \textsuperscript{\textbf{#1}}\hspace{0.1em}%
}

% ESV text wrapper (uses Bembo)
\newcommand{\esvtext}[1]{{\bembofont #1}}

% Section heading (ESV section titles)
% Uses needspace to prevent orphaned headings
\newcommand{\sectionheading}[1]{%
    \needspace{3\baselineskip}%
    \vspace{0.6em}%
    {\bembofont\textsc{#1}}%
    \vspace{0.3em}%
    \par%
}

% Section title for the passage
\newcommand{\passagetitle}[1]{%
    \begin{center}
        {\Large\bfseries #1}
        \vspace{0.5em}
    \end{center}
}

% Column headers
\newcommand{\columnheaders}{%
    \begin{paracol}{2}
        \begin{center}
            {\small\textsc{Greek Interlinear}}
        \end{center}
        \switchcolumn
        \begin{center}
            {\small\bembofont\textsc{English Standard Version}}
        \end{center}
    \end{paracol}
    \vspace{0.5em}
    \hrule
    \vspace{0.5em}
}

% ============================================
% Document Settings
% ============================================
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.4em}

% Reduced baseline skip for tighter interlinear text
\setlength{\baselineskip}{11pt}

% Allow more flexible line breaking to prevent overflow
\tolerance=1000
\emergencystretch=3em
\hfuzz=0.5pt

% Prevent hyphenation in Greek
\hyphenpenalty=10000
\exhyphenpenalty=10000

% ============================================
% Header/Footer Configuration (Single-sided)
% ============================================
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Header: Chapter info left, verse info right
\fancyhead[L]{\small\textit{\leftmark}}
\fancyhead[R]{\small\textit{\rightmark}}

% Footer: TOC icon left, page number center, empty right
\fancyfoot[L]{\hyperlink{toc}{\Large\faIcon{home}}}
\fancyfoot[C]{\thepage}

% ============================================
% Strong's Linked Gloss Commands
% ============================================

% Interlinear gloss with Strong's link
% Usage: \glosslink{Greek}{english}{G1234}
\newcommand{\glosslink}[3]{%
    \mbox{%
        \begin{tabular}[b]{@{}c@{}}
            {\scriptsize\color{gray}\hyperlink{strongs:#3}{#2}}\\[-4pt]
            {\greekfont #1}
        \end{tabular}%
    }\hspace{0.15em}\allowbreak%
}

% Appendix entry anchor
% Usage: \strongsentry{G1234}{lemma}{translit}{definition}
\newcommand{\strongsentry}[4]{%
    \hypertarget{strongs:#1}{}%
    \noindent\textbf{#1} --- {\greekfont #2} (#3)\par
    \hangindent=1em\hangafter=0
    \small #4\par
    \vspace{0.5em}%
}

% Chapter marker for headers (article class doesn't have \chaptermark)
\newcommand{\chaptermark}[1]{\markboth{#1}{}}

% Verse marker for headers (right side)
\newcommand{\setverseheader}[1]{\markright{#1}}
